<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Invoice</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
body{margin:0;background:#f6eeee;font-family:Inter}
.page{max-width:900px;margin:30px auto;background:#fff;box-shadow:0 20px 50px rgba(0,0,0,.2)}
.header{display:flex;justify-content:space-between;align-items:flex-end;padding:30px;
background:linear-gradient(120deg,#111 60%,#fff 60%);border-radius:0 0 80px 0}
.logo{color:#fff;font-size:20px;font-weight:700}
.invoice-title{text-align:right}
.invoice-title h1{margin:0;letter-spacing:8px}
.invoice-meta{margin-top:10px;font-size:14px}
.content{padding:30px}
.top-box{display:grid;grid-template-columns:1fr 1fr;border:1px solid #333}
.box{padding:16px;min-height:140px}
.box h3{margin:0 0 8px;font-size:15px}
table{width:100%;border-collapse:collapse;margin-top:30px}
th,td{border:1px solid #333;padding:10px}
th{background:#b0b0b0}
.totals{width:40%;margin-left:auto;margin-top:20px}
.bold{font-weight:700}
.footer{margin-top:40px;font-size:14px}
.footer-bottom{background:#111;color:#fff;padding:12px;text-align:center;font-size:13px}
@media print{body{background:#fff}.page{box-shadow:none;margin:0}}
</style>
</head>

<body>

<div class="page">

<!-- HEADER -->
<div class="header">
  <div class="logo" id="companyName">COMPANY LOGO</div>
  <div class="invoice-title">
    <h1>INVOICE</h1>
    <div class="invoice-meta">
      Invoice # : <span id="invoiceNo"></span><br>
      Invoice Date : <span id="invoiceDate"></span>
    </div>
  </div>
</div>

<div class="content">

<!-- BILL TO -->
<div class="top-box">
  <div class="box">
    <h3>Bill To :</h3>
    <strong id="custName"></strong><br>
    Box No: <span id="boxno"></span><br>
    Phone: <span id="mobile"></span><br>
    Address: <span id="address"></span>
  </div>
  <div class="box">
    <h3>Service Description :</h3>
    Monthly Cable TV Subscription
  </div>
</div>

<!-- TABLE -->
<table>
<thead>
<tr>
  <th>Month</th>
  <th>Description</th>
  <th>Qty</th>
  <th>Rate</th>
  <th>Amount</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<!-- TOTALS -->
<div class="totals">
<table>
<tr><td>Subtotal</td><td id="subTotal">₹0</td></tr>
<tr><td>Tax (<span id="taxRate">0</span>%)</td><td id="taxAmount">₹0</td></tr>
<tr><td class="bold">Total</td><td class="bold" id="grandTotal">₹0</td></tr>
</table>
</div>

<!-- FOOTER -->
<div class="footer">
Make all checks payable to :<br>
<strong id="bankCompany"></strong><br>
<span id="bankName"></span><br>
<span id="bankAcc"></span>
</div>

</div>

<div class="footer-bottom" id="footerText"></div>
</div>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyD80rGSiaQD5PiFQfZokB7QueEEyORD57w",
  databaseURL: "https://new-customer-e3c48-default-rtdb.firebaseio.com",
  projectId: "new-customer-e3c48"
});

/* INVOICE META */
invoiceNo.innerText = "INV-" + Date.now();
invoiceDate.innerText = new Date().toLocaleDateString();

/* LOAD BILL SETTINGS */
firebase.database().ref("billSettings").once("value",s=>{
  const d=s.val();
  companyName.innerText = d.companyName;
  bankCompany.innerText = d.companyName;
  bankName.innerText = d.bank;
  bankAcc.innerText = d.account;
  footerText.innerText = d.footer;
  taxRate.innerText = d.tax;
});

/* LOAD CUSTOMER */
const box = new URLSearchParams(location.search).get("boxno");
let subtotal = 0;

firebase.database().ref("customers").orderByChild("boxno").equalTo(box)
.once("value",snap=>{
  snap.forEach(c=>{
    const v=c.val();
    custName.innerText=v.name;
    boxno.innerText=v.boxno;
    mobile.innerText=v.mobile;
    address.innerText=v.address;

    const row = `
      <tr>
        <td>${new Date().toLocaleString('default',{month:'long'})}</td>
        <td>Monthly Subscription</td>
        <td>1</td>
        <td>₹${v.amount}</td>
        <td>₹${v.amount}</td>
      </tr>`;
    rows.innerHTML=row;
    subtotal=v.amount;

    subTotal.innerText="₹"+subtotal;

    firebase.database().ref("billSettings").once("value",s=>{
      const tax=s.val().tax||0;
      const taxAmt=subtotal*(tax/100);
      taxAmount.innerText="₹"+taxAmt.toFixed(2);
      grandTotal.innerText="₹"+(subtotal+taxAmt).toFixed(2);
    });
  });
});
</script>

</body>
</html>
