<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Edit Customer ‚Äì Sindhura TV</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
:root{
  --primary:#9b1c1c;
  --primary-dark:#7a1414;
  --bg:#f6eeee;
  --card:#ffffff;
  --border:#e5e7eb;
  --muted:#6b7280;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter;
  background:var(--bg);
}
.container{
  max-width:720px;
  margin:40px auto;
  background:var(--card);
  padding:36px;
  border-radius:24px;
  box-shadow:0 16px 40px rgba(0,0,0,.12);
}
h2{
  margin:0 0 6px;
  color:var(--primary);
}
p{
  margin:0 0 26px;
  color:var(--muted);
  font-size:14px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
}
label{
  font-size:13px;
  font-weight:600;
}
input,select{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-top:6px;
  font-size:14px;
}
input:focus,select:focus{
  outline:none;
  border-color:var(--primary);
}
.full{grid-column:1/3}
.actions{
  margin-top:28px;
  display:flex;
  gap:16px;
}
button{
  padding:14px 28px;
  border:none;
  border-radius:16px;
  font-weight:600;
  cursor:pointer;
}
.save{
  background:var(--primary);
  color:#fff;
}
.save:hover{
  background:var(--primary-dark);
}
.cancel{
  background:#e5e7eb;
}
@media(max-width:700px){
  .grid{grid-template-columns:1fr}
  .full{grid-column:1}
  .actions{flex-direction:column}
}
</style>
</head>

<body>

<div class="container">
  <h2>‚úèÔ∏è Edit Customer</h2>
  <p>Update customer details and payment information</p>

  <div class="grid">
    <div>
      <label>Customer Name</label>
      <input id="name">
    </div>

    <div>
      <label>Mobile Number</label>
      <input id="mobile">
    </div>

    <div>
      <label>Box Number</label>
      <input id="boxno">
    </div>

    <div>
      <label>Area</label>
      <select id="center">
        <option value="">Select Area</option>
        <option value="Area 1">Area 1</option>
        <option value="Area 2">Area 2</option>
        <option value="Area 3">Area 3</option>
      </select>
    </div>

    <div>
      <label>Joining Month</label>
      <input type="month" id="joiningMonth">
    </div>

    <div>
      <label>Monthly Amount (‚Çπ)</label>
      <input type="number" id="amount">
    </div>

    <div class="full">
      <label>Total Paid Amount (‚Çπ)</label>
      <input type="number" id="paid">
    </div>
  </div>

  <div class="actions">
    <button class="save" onclick="updateCustomer()">üíæ Update Customer</button>
    <button class="cancel" onclick="goBack()">‚Ü© Cancel</button>
  </div>
</div>

<script>
/* ================= NAV ================= */
function goBack(){
  window.location.href = "customer.html";
}

/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyD80rGSiaQD5PiFQfZokB7QueEEyORD57w",
  authDomain: "new-customer-e3c48.firebaseapp.com",
  databaseURL: "https://new-customer-e3c48-default-rtdb.firebaseio.com",
  projectId: "new-customer-e3c48"
});

const customersRef = firebase.database().ref("customers");

/* ================= GET CUSTOMER ID ================= */
const params = new URLSearchParams(window.location.search);
const editId = params.get("id");

if(!editId){
  swal("Error ‚ùå","Invalid customer ID","error")
    .then(goBack);
}

/* ================= INPUTS ================= */
const nameEl = document.getElementById("name");
const mobileEl = document.getElementById("mobile");
const boxEl = document.getElementById("boxno");
const centerEl = document.getElementById("center");
const joinEl = document.getElementById("joiningMonth");
const amountEl = document.getElementById("amount");
const paidEl = document.getElementById("paid");

/* ================= LOAD CUSTOMER ================= */
customersRef.child(editId).once("value", snap=>{
  if(!snap.exists()){
    swal("Error","Customer not found","error")
      .then(goBack);
    return;
  }

  const v = snap.val();
  nameEl.value = v.name || "";
  mobileEl.value = v.mobile || "";
  boxEl.value = v.boxno || "";
  centerEl.value = v.center || "";
  joinEl.value = v.joiningMonth || "";
  amountEl.value = v.amount || 0;
  paidEl.value = v.paid || 0;
});

/* ================= UPDATE ================= */
function updateCustomer(){
  const data = {
    name: nameEl.value.trim(),
    mobile: mobileEl.value.trim(),
    boxno: boxEl.value.trim(),
    center: centerEl.value,
    joiningMonth: joinEl.value,
    amount: Number(amountEl.value),
    paid: Number(paidEl.value)
  };

  if(!data.name || !data.boxno){
    swal("Missing Fields ‚ö†Ô∏è","Name and Box Number are required","warning");
    return;
  }

  swal({
    title: "Confirm Update",
    text: "Save changes to this customer?",
    icon: "warning",
    buttons: ["Cancel","Update"]
  }).then(ok=>{
    if(ok){
      customersRef.child(editId).update(data)
        .then(()=>{
          swal("Updated ‚úÖ","Customer updated successfully","success")
            .then(goBack);
        })
        .catch(()=>{
          swal("Error ‚ùå","Update failed","error");
        });
    }
  });
}
</script>

</body>
</html>
